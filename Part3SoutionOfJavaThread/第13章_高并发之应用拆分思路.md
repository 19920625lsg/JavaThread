# 第13章 高并发之应用拆分思路

## 1 概述

一个服务器再怎么优化，其处理能力都是有限的。之前介绍过过扩容、缓存机制、消息队列等优化方案，都是十分有效的。根据项目情况，将一个整体应用拆分为多个应用也不失为一个方案。比如按功能模块及功能模块使用频率拆分。

例子如下：

![股票交易系统演示应用拆分](https://img-blog.csdnimg.cn/2019042422402741.png)

### 应用拆分的好处

+ 1、减轻并优化了整个统一的应用的压力。
+ 2、拆分后的应用可以被更精准的监控。
+ 3、不同子应用会更容易管理及局部优化。
+ 4、更利于功能模块内部的团队协作。

### 应用拆分的弊端

+ 1、管理的复杂度上升。
+ 2、代价昂贵。使用资源的成本增加。
+ 3、网络开销增加，带宽要求增加。

### 应用拆分的基本原则

+ 1、业务优先。优先按照业务的功能拆分为小应用。
+ 2、循序渐进，迭代拆分并进行测试。
+ 3、兼顾技术：重构、分层。
+ 4、可靠测试。减少或避免累积错误的出现。

### 应用拆分的思考

+ 1、应用之间通信：`RPC(dubbo等)`或`消息队列`(适用于传输数据包小，但传输量大，对数据的实时性要求不高的场景)
+ 2、应用之间的数据库设计：每个应用都应有自己的数据库，其中一些共同的信息可以另建一个公共数据库来存放
+ 3、避免事务操作跨应用，降低耦合度

## 2 服务化的Dubbo

Dubbo也是一种`分布式的服务框架`，可实现`软负载均衡`。  
但Dubbo Service不是分布式的服务框架，但可以结合其他组件实现负载均衡。  
Dubbo还提供了`监控中心`(可选，需要单独配置)和`调用中心`。  

其处理流程原理图如下：

![Dubbo处理流程原理图](https://img-blog.csdnimg.cn/20190424224319771.png)

其中的`Registey`模块选择`zookeeper`

服务端`Provider`通常会声明一个`Java接口类`来代表自己提供的服务。当消费端Consumer获得接口并配置完相应的内容后，会调用相应的接口方法，底层实际就对应着`invoke()方法调用服务`，并将`结果封装`为`接口定义的类型`返回。

## 3 微服务

`微服务`是一个`架构概念`。**通过功能分解，对解决方案解耦，并提供更加灵活的服务支持**。它可扩展单个组件，而不是整个应用程序堆栈，从而满足服务等级协议。它围绕着业务领域来创建应用，该应用可独立地进行开发、管理、迭代。在分散的组件中，使用云架构和平台式管理、部署和服务功能，使产品交付更加简单。它的`本质是通过使用功能明确、业务精炼的服务，去解决更大更实际的问题`。

微服务处理流程图如下：

![微服务处理流程图](https://img-blog.csdnimg.cn/20190424224613944.png)
