# 第16章 数据库分库分表与高可用手段

## 16.1 数据库切库、分库、分表思路

### 数据库瓶颈

+ 单个库数据量太大(1T~2T):多个库
+ 单个数据库服务器压力过大、读写瓶颈：多个库
+ 单个表数据量过大：分表

### 数据库切库

+ 读写分离：一个主库多个从库，主库负责数据的更新和实时数据的查询，从库负责非实时数据的查询。
  + 原因：因为实践操作中数据库都是读多写少的，而读取数据的耗时比较长，占用服务器CPU比较大。
  + 采用解决方式：我们通常的做法就是把查询从主库中抽取出来，采用多个从库使用负载均衡减轻每个从库的查询压力。
  + 读写分离的目标：可以有效减少主库的压力，把用户查询数据的请求分发到不同的从库上，从而保障系统的健壮性。
  + 读写分离的方式有那些？
    + 动态数据源切换(使用注解、SpringAOP等实现)
    + 自定义注解完成数据库切库--代码实现，参考博客[自定义注解完成数据库切库](http://www.imooc.com/article/22556)

### 数据库支持多个数据源与分库

参考博客[多个数据源的轻松支持](http://www.imooc.com/article/22609)

### 数据库分表

#### 什么时候考虑分表

当经过SQL优化和分库后仍不能提高数据库响应速度，应该就是表太大了，就必须考虑分表了

#### 数据库分表的好处

+ 1、单表的并发能力提高，磁盘的IO性能提高，写操作效率随之提高
+ 2、查询效率提高
+ 3、读写锁影响的数据量变少，插入数据库需要重新建立索引的数据变少

#### 横向分表

将一张大表横向切割为表结构完全相同的多个小表

#### 纵向分表

将本来可以在一张表里面的内容，人为的划分成多张表。（根据数据的活跃度进行分离）

#### 参考博客

[利用mybatis插件shardbatis2.0实现数据库分表](http://www.imooc.com/article/25256)

